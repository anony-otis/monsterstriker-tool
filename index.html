<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2025 怪物彈珠 高級配裝計算器｜全怪物搜尋＋即時推薦</title>
  <meta name="description" content="台灣最強モンスト工具：827隻怪物即時搜尋、完整被動/聚能/種族/幸運技能顯示">
  <style>
    body{font-family:"Microsoft JhengHei",Arial,sans-serif;background:#0d1117;color:#c9d1d9;padding:20px;line-height:1.6;}
    h1,h2{color:#58a6ff;}
    input,select,button{padding:12px 16px;font-size:16px;margin:8px 0;border-radius:8px;border:1px solid #30363d;background:#161b22;color:#c9d1d9;}
    input{width:100%;max-width:500px;box-sizing:border-box;}
    button{background:#238636;color:#fff;font-weight:bold;cursor:pointer;}
    button:hover{background:#2ea043;}
    .card{background:#161b22;padding:20px;margin:15px 0;border-radius:12px;box-shadow:0 4px 12px rgba(88,166,255,0.2);}
    img{width:80px;height:80px;border-radius:50%;border:4px solid #58a6ff;}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;}
    .monster .card{display:flex;gap:20px;align-items:center;background:#21262d;}
    .tag{background:#58a6ff;color:#0d1117;padding:6px 12px;margin:4px;border-radius:6px;display:inline-block;font-size:14px;font-weight:bold;}
    .passive .tag{background:#1f6feb;}
    .gauge .tag{background:#f85149;color:#fff;}
    .luck .tag{background:#da3633;color:#fff;}
    #searchInfo{margin:10px 0;color:#8b949e;}
  </style>
</head>
<body>
  <h1>怪物彈珠 高級配裝計算器</h1>
  <p>827隻怪物即時搜尋｜完整顯示被動（含聚能）、種族、幸運技能｜一鍵生成配裝</p>

  <!-- 怪物搜尋框 -->
  <div class="card">
    <input type="text" id="searchBox" placeholder="輸入怪物名稱搜尋（支援中日文）..." oninput="filterMonsters()">
    <p id="searchInfo">全部 827 隻怪物</p>
  </div>

  <!-- 關卡選擇 -->
  <div class="card">
    <select id="quest" onchange="calc()"></select>
  </div>

  <!-- 四隻怪物 -->
  <div class="grid">
    <div class="card"><img id="icon1"><select id="m1" onchange="calc()"></select></div>
    <div class="card"><img id="icon2"><select id="m2" onchange="calc()"></select></div>
    <div class="card"><img id="icon3"><select id="m3" onchange="calc()"></select></div>
    <div class="card"><img id="icon4"><select id="m4" onchange="calc()"></select></div>
  </div>

  <button onclick="calc()">生成推薦配裝</button>

  <div id="result" class="card">載入中…</div>

  <script>
    let DB = {monsters: [], quests: [], trans: {}};
    let allOptionsHTML = '';

    async function load() {
      try {
        const [m, q, t] = await Promise.all([
          fetch('data/monsters.json').then(r=>r.json()),
          fetch('data/quests.json').then(r=>r.json()),
          fetch('data/translation.json').then(r=>r.json()).catch(()=>({}))
        ]);
        DB = {monsters: m, quests: q, trans: t};

        // 關卡
        document.getElementById('quest').innerHTML = '<option value="">請選擇關卡</option>' + 
          q.map(x=>`<option value="${x.id}">${x.name}</option>`).join('');
        document.getElementById('quest').selectedIndex = 1;

        // 怪物選單原始選項
        allOptionsHTML = '<option value="">請選擇怪物</option>' + 
          m.map(x => {
            const zh = DB.trans[x.name_jp] || '';
            const display = zh ? `${zh} (${x.name_jp})` : x.name_jp;
            return `<option value="${x.name_jp}" data-zh="${zh.toLowerCase()}" data-jp="${x.name_jp.toLowerCase()}">${display}</option>`;
          }).join('');

        // 初始顯示全部
        document.querySelectorAll('#m1,#m2,#m3,#m4').forEach(s => s.innerHTML = allOptionsHTML);
        document.getElementById('searchInfo').innerText = `全部 ${m.length} 隻怪物`;

        calc();
      } catch(e) {
        document.getElementById('result').innerHTML = `<p style="color:red">載入失敗：${e.message}</p>`;
      }
    }

    function filterMonsters() {
      const query = document.getElementById('searchBox').value.toLowerCase().trim();
      if (!query) {
        document.querySelectorAll('#m1,#m2,#m3,#m4').forEach(s => s.innerHTML = allOptionsHTML);
        document.getElementById('searchInfo').innerText = `全部 ${DB.monsters.length} 隻怪物`;
        return;
      }

      const filtered = DB.monsters.filter(m => {
        const zh = (DB.trans[m.name_jp] || '').toLowerCase();
        const jp = m.name_jp.toLowerCase();
        return zh.includes(query) || jp.includes(query);
      });

      const filteredHTML = '<option value="">請選擇怪物</option>' + 
        filtered.map(x => {
          const zh = DB.trans[x.name_jp] || '';
          const display = zh ? `${zh} (${x.name_jp})` : x.name_jp;
          return `<option value="${x.name_jp}">${display}</option>`;
        }).join('');

      document.querySelectorAll('#m1,#m2,#m3,#m4').forEach(s => s.innerHTML = filteredHTML);
      document.getElementById('searchInfo').innerText = `找到 ${filtered.length} 隻怪物`;
    }

    function calc() {
      // 原有 calc 邏輯（保持不變）
      const qid = document.getElementById('quest').value;
      if (!qid) return;
      const q = DB.quests.find(x=>x.id==qid);

      const selected = [1,2,3,4].map(i=>document.getElementById('m'+i).value).filter(Boolean);
      let html = `<h2>${q.name}　隊伍資料</h2>`;

      selected.forEach((jpName,i)=>{
        const m = DB.monsters.find(x=>x.name_jp===jpName);
        if (!m) return;
        const zh = DB.trans[m.name_jp] || m.name_jp;
        document.getElementById('icon'+(i+1)).src = m.icon || 'https://via.placeholder.com/80?text=?';

        const gauge = m.passive.filter(p => p.startsWith('ゲージ：'));
        const normalPassive = m.passive.filter(p => !p.startsWith('ゲージ：'));

        html += `
          <div class="monster card">
            <img src="${m.icon}" alt="${zh}">
            <div>
              <h3>${zh}</h3>
              <p><b>屬性：</b>${m.attr}　<b>擊種：</b>${m.type_of_shot}</p>
              <p><b>種族：</b>${m.race}</p>
              <p class="passive"><b>被動：</b>
                ${normalPassive.map(t=>`<span class="tag">${t}</span>`).join('')}
              </p>
              ${gauge.length ? `<p class="gauge"><b>聚能被動：</b>${gauge.map(t=>`<span class="tag">${t.replace('ゲージ：','')}</span>`).join('')}</p>` : ''}
              <p class="luck"><b>幸運技能：</b>
                ${m.luck_skills.map(t=>`<span class="tag">${t}</span>`).join('') || '無'}
              </p>
            </div>
          </div>`;
      });
      document.getElementById('result').innerHTML = html || '<p>請選擇怪物</p>';
    }

    load();
  </script>
</body>
</html>
